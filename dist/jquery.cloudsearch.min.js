!function(e){var a={cloudSearch:{url:"",key:""},googleGeocodeApi:{key:null,url:"https://maps.googleapis.com/maps/api/geocode/json",language:"en"},geoSearch:{lat:null,lng:null,fieldName:"_distance",cloudFieldName:null,unit:"K",maxDistance:null},searchParams:{q:"matchall",return:"_all_fields",size:10,sort:"_score desc",start:0,"q.parser":"structured"},facets:{displayFacets:[],facet:'<a href="#"/>',facetClass:"facet",titleWrapper:"<h2/>",title:'<a href="#"/>',titleClass:"",titleOnClick:function(){},titleWrapperClass:"facet-title",container:"#facets",wrapperContainer:"<ul/>",wrapperContainerClass:"facet-list",wrapper:"<li/>",wrapperClass:"facet-item",showCount:!0,countWrapper:null,countWrapperClass:null,facetOnClick:function(t){t.preventDefault();var s=e(this).data("cloudsearchFacetName")+"||"+e(this).data("cloudsearchFacetValue");if(-1!=a.facetsSelected.indexOf(s))return;a.searchParams.start=0,r.currentPage=1,a.facetsSelected.push(s),a.facetsApplied.onChange.call(a.facetsSelected.slice(0)),a.facets.onFacetSelect.call(a.facetsSelected.slice(0)),n()},searchMode:"and",onFacetSelect:function(){var r=a.facetsApplied;if(!r.container)return;var t=this.pop(),s=e(r.container),c=t.split("||");if(-1!=r.ignoreFacets.indexOf(c[0]))return;e("<a/>").text(c[1]).attr({href:"#"}).attr(r.extraAttributes).data("value",t).addClass(r.class).on("click",function(r){r.preventDefault(),a.facetsSelected.splice(a.facetsSelected.indexOf(e(this).data("value")),1),a.facetsApplied.onChange.call(a.facetsSelected.slice(0)),e(this).remove(),n()}).appendTo(s)},groupWrapper:"<div/>",groupWrapperClass:"group"},facetsApplied:{container:null,class:"selected-facet",extraAttributes:{},ignoreFacets:[],onChange:function(){}},facetsDictionary:null,facetsSelected:[],results:{container:"#results",template:null,noResults:"Sorry there are no results for your query",onCreate:function(){},pager:{container:null,renderPager:!1,loadMore:!0,appendPager:!0,pagerRangeIncrement:5,labels:{prev:"previous",next:"next",first:"first",last:"last",results:"results for",load:"load more",ada:{prev:"previous page of results",next:"next page of results",first:"first page of results",last:"last page of results",load:"load more results"}},onRender:function(){},onPageChange:function(){}}},urlParameters:{address:"a",latitude:"l",longitude:"ln",latlong:null,search:"q",page:"p"},onResults:function(){(function(r){var t=a.facets,s=e(t.container);s&&r.facets&&(s.html(""),e(Object.keys(a.facetsDictionary)).each(function(n,c){if(r.facets[c]){var l=a.facetsDictionary&&a.facetsDictionary[c]?a.facetsDictionary[c]:c,o=e(t.title).addClass(t.titleClass).text(l);t.titleWrapper&&(o=e(t.titleWrapper).addClass(t.titleWrapperClass).append(o)),s.append(o),o.on("click",t.titleOnClick);var i=e(t.wrapperContainer).addClass(t.wrapperContainerClass);s.append(i);var d=0;if(e(r.facets[c].buckets).each(function(r,s){var n=e(t.facet).addClass(t.facetClass).html(s.value).on("click",t.facetOnClick).data("cloudsearchFacetName",c).data("cloudsearchFacetValue",s.value);t.showCount&&a.facets.countWrapper?e(a.facets.countWrapper).text("("+s.count+")").addClass(a.facets.countWrapperClass).appendTo(n):t.showCount&&n.append(" ("+s.count+")"),-1!=a.facetsSelected.indexOf(c+"|"+s.value)&&n.addClass("selected-facet"),t.wrapper?e(t.wrapper).addClass(t.wrapperClass).append(n).appendTo(i):i.append(n),d++}),t.groupWrapper&&d>0){var p=e(t.groupWrapper).addClass(t.groupWrapperClass);s.append(p),o.appendTo(p),i.appendTo(p)}0==d&&(o.remove(),i.remove())}}))})(this),function(t){var s=a.results,n=e(s.container)?e(s.container):e(r.container);n&&t.hits.hit&&(s.pager.loadMore&&0!=a.searchParams.skip||n.html(""),0==t.hits.found&&e("<div/>").addClass("cloudsearch-no-results").text(s.noResults).appendTo(n),e(t.hits.hit).each(function(t,c){var l=c.fields;if(s.template){var o=e(s.template);e(':not([data-cloudsearch-field=""])',o).not().each(function(t,s){var n,l,o,i,d,p,g,u,h,f,m=e(s).data("cloudsearchField"),v="";if(m&&c.fields[m])v=c.fields[m];else if(m==a.geoSearch.fieldName&&r.isGeoSearch&&c[a.geoSearch.cloudFieldName]){var P=c[a.geoSearch.cloudFieldName];n=a.geoSearch.lat,l=a.geoSearch.lng,o=P.coordinates[1],i=P.coordinates[0],d=a.geoSearch.unit,p=Math.PI*n/180,g=Math.PI*o/180,u=l-i,h=Math.PI*u/180,(f=Math.sin(p)*Math.sin(g)+Math.cos(p)*Math.cos(g)*Math.cos(h))>1&&(f=1),f=60*(f=180*(f=Math.acos(f))/Math.PI)*1.1515,"K"==d&&(f*=1.609344),"N"==d&&(f*=.8684),v=f}var C=e(s).data("cloudsearchValueFormat");C&&window[C]&&(v=window[C](v,c)),m&&e(s).html(v)}),n.append(o),s.onCreate.call(o)}else{var i=e("<ul/>"),d=e("<hr/>");e(Object.keys(l)).each(function(a,r){if(!l[r]||""==l[r])return!0;var t=e("<li/>").text(r+" : ").appendTo(i);e("<strong/>").text(l[r]).appendTo(t)}),i.appendTo(n),d.appendTo(n),s.onCreate.call(i)}}),r.rendered=!0)}(this),this.hits.found>a.searchParams.size&&(t=a.results.pager).renderPager&&(e(t.container).empty(),r.pagerRendered||(r.pagerRange=[1,t.pagerRangeIncrement]),function(){var t=a.results.pager,c=e(t.container);if(c){if(t.loadMore)c.append(s("load"));else{var l;r.currentPage<r.pagerRange[0]?(r.pagerRange[0]=r.pagerRange[0]-t.pagerRangeIncrement,r.pagerRange[1]=r.pagerRange[1]-t.pagerRangeIncrement):r.currentPage>r.pagerRange[1]&&(r.pagerRange[0]=r.pagerRange[0]+t.pagerRangeIncrement,r.pagerRange[1]=r.pagerRange[1]+t.pagerRangeIncrement),c.append(s("prev")),l=r.pagerRendered?e(".pager-nav-items").empty():e("<div/>").addClass("pager-nav-items");for(var o=r.pagerRange[0];o<=r.pagerRange[1]&&o<=r.totalPages;){var i=e('<a href="#">').data("targetPage",o);o===r.currentPage&&(i=e("<span></span>")),i.text(o),l.append(i),o++}c?(c.append(l),c.append(s("next"))):(c.append(s("next")),e(r.container).after(c))}r.pagerRendered||(e(".pager-prev, .pager-next, .pager-load").on("click",function(t){var s;t.preventDefault(),e(this).data("disabled")||(s=e(this).hasClass("pager-prev"),a.results.pager,a.searchParams.size&&r.currentPage&&r.rendered&&(r.rendered=!1,r.currentPage=s?r.currentPage-1:r.currentPage+1,a.searchParams.start=(r.currentPage-1)*a.searchParams.size,n()))}),e(".pager-nav-items a").on("click",function(t){var s;t.preventDefault(),s=e(this).data("targetPage"),r.currentPage=s,a.searchParams.skip=(r.currentPage-1)*a.searchParams.size,n()}))}}(),r.pagerRendered=!0);var t;a.onLoad.call(this,r)},onLoad:function(){},debug:!1},r={container:null,totalPages:0,currentPage:1,pagerRange:[],pagerRendered:!1,waitingLatLong:!1,isGeoSearch:!1,totalResults:0,initialized:!1,rendered:!1};function t(e){c("Google Geocode return:"),c(e);"OK"==e.status&&e.results.length>0&&(a.geoSearch.lat=e.results[0].geometry.location.lat,a.geoSearch.lng=e.results[0].geometry.location.lng),r.waitingLatLong=!1,n()}function s(t){var s=a.results.pager,n=e("<a/>").text(s.labels[t]).addClass("pager-navs").addClass("pager-"+t).attr("href","#");return r.pagerRendered&&(n=e(".pager-navs.pager-"+t)),"prev"==t?r.currentPage>1?n.data("disabled",!1).removeClass("disabled"):n.data("disabled",!0).addClass("disabled"):r.totalPages>r.currentPage?n.data("disabled",!1).removeClass("disabled"):n.data("disabled",!0).addClass("disabled"),n}function n(){if(r.isGeoSearch=!1,e(a.results.pager.container).empty(),r.pagerRendered=!1,!r.waitingLatLong){if(a.geoSearch.lat&&a.geoSearch.lng&&(c("Geo searching..."),c(a.geoSearch.lat),c(a.geoSearch.lng),r.isGeoSearch=!0,!a.searchParams.orderby||0==a.searchParams.orderby.indexOf(a.geoSearch.fieldName))){var t="geo.distance("+a.geoSearch.cloudFieldName;t+=", geography'POINT("+a.geoSearch.lng+" "+a.geoSearch.lat+")')",a.searchParams.orderby&&-1!=a.searchParams.orderby.indexOf(" desc")&&(t+=" desc"),a.searchParams.orderby=t}var s=null,n=a.searchParams.fq;if(a.facetsDictionary&&e(Object.keys(a.facetsDictionary)).each(function(e,r){a.searchParams["facet."+r]="{}"}),a.facetsSelected.length>0){var l=[];a.facetsSelected.forEach(function(e,a){var r=e.split("||");l.push(r[0]+": '"+r[1].replace(/[']/gi,"''")+"'")}),s="("+a.facets.searchMode+" "+l.join(" ")+")",n&&(s="("+a.facets.searchMode+" "+a.searchParams.fq+" "+s+")")}if(r.isGeoSearch&&a.geoSearch.maxDistance){c("Filter Geo searching by distance : "+a.geoSearch.maxDistance);var o="geo.distance("+a.geoSearch.cloudFieldName+", geography'POINT("+a.geoSearch.lng+" "+a.geoSearch.lat+")') le "+a.geoSearch.maxDistance;s?s+=" and "+o:s=o}s&&(a.searchParams.fq=s);var i={crossDomain:!0,url:a.cloudSearch.url,method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","X-Api-Key":a.cloudSearch.key,"Cache-Control":"no-cache"},data:a.searchParams};e.ajax(i).done(function(e){e.hits?(r.totalResults=e.hits.found>0?e.hits.found:-1,r.totalPages=Math.ceil(r.totalResults/a.searchParams.size),a.onResults.call(e,r)):e.error&&c(e.error)}),a.searchParams.fq=n}}function c(e){a.debug&&window.console&&window.console.log&&window.console.log(e)}function l(e){if(!e)return null;var a,r,t=decodeURIComponent(window.location.search.substring(1)).split("&");for(r=0;r<t.length;r++)if((a=t[r].split("="))[0]===e)return void 0===a[1]||a[1];return null}e.fn.cloudsearch=function(s,c){switch(r.container=this,c||(c="search"),s&&(a=e.extend(!0,a,s),function(){var s=a.urlParameters,n=l(s.address),c=l(s.latitude),o=l(s.longitude),i=l(s.latlong),d=l(s.search);i&&-1!=i.indexOf(",")&&(c=i.split(",")[0],o=i.split(",")[1]);d&&("structured"==a.searchParams["q.parser"]?(a.searchParams.q="(or ",e(d.split(" ")).each(function(e,r){a.searchParams.q+="(term '"+r+"')",a.searchParams.q+="(prefix '"+r+"')"}),a.searchParams.q+=")"):a.searchParams.q=d);c&&o&&(a.geoSearch.lat=c,a.geoSearch.lng=o);if(n&&!c&&!o&&!i){var p=function(s){var n=a.googleGeocodeApi;if(!n.key)return;r.waitingLatLong=!0;var c=n.url;c+=-1!=c.indexOf("?")?"&":"?",c+="key="+n.key,c+="&address="+s,c+="&language="+n.language,e.getJSON(c,t)}(n);p&&(c=p[0],o=p[1])}}()),r.initialized||e(a.facetsSelected).each(function(e,r){a.facets.onFacetSelect.call([r])}),c){case"search":n();break;case"resetFacets":a.facetsSelected=[],a.facets.onFacetSelect.call(a.facetsSelected),n()}return r.initialized=!0,this}}(jQuery);