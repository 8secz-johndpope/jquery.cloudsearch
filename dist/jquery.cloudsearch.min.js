!function(e){var a={cloudSearch:{url:"",key:""},googleGeocodeApi:{key:null,url:"https://maps.googleapis.com/maps/api/geocode/json",language:"en"},geoSearch:{lat:null,lng:null,fieldName:"_distance",cloudFieldName:null,unit:"K",maxDistance:null},searchParams:{q:"matchall",return:"_all_fields",size:10,sort:"_score desc",start:0,"q.parser":"structured"},dates:{hasDates:!1,fields:{zone:"EST",from:{cloudSearchField:null,fieldId:null},to:{cloudSearchField:null,fieldId:null}}},facets:{facet:'<a href="#"/>',facetClass:"facet",titleWrapper:"<h2/>",title:'<a href="#"/>',titleClass:"",titleOnClick:function(){},titleWrapperClass:"facet-title",container:"#facets",wrapperContainer:"<ul/>",wrapperContainerClass:"facet-list",wrapper:"<li/>",wrapperClass:"facet-item",showCount:!0,countWrapper:null,countWrapperClass:null,facetOnClick:function(r){r.preventDefault();var s=e(this).data("cloudsearchFacetName")+"||"+e(this).data("cloudsearchFacetValue");"SELECT"==r.target.nodeName&&(s=e(this).data("cloudsearchFacetName")+"||"+e(this).val());if(-1!=a.facetsSelected.indexOf(s))return;a.searchParams.start=0,t.currentPage=1,a.facetsSelected.push(s),a.facetsApplied.onChange.call(a.facetsSelected.slice(0)),a.facets.onFacetSelect.call(a.facetsSelected.slice(0)),n()},searchMode:"and",onFacetSelect:function(){var r=a.facetsApplied;if(!r.container)return;var s=this.pop(),l=e(r.container),c=s.split("||");if(-1!=r.ignoreFacets.indexOf(c[0]))return;e("<a/>").text(c[1]).attr({href:"#"}).attr(r.extraAttributes).data("value",s).addClass(r.class).on("click",function(r){r.preventDefault(),a.facetsSelected.splice(a.facetsSelected.indexOf(e(this).data("value")),1),a.searchParams.start=0,t.currentPage=1,a.facetsApplied.onChange.call(a.facetsSelected),e(this).remove(),l.children().not(".clear-all-facets").length>0||l.hide(),n()}).appendTo(l),r.clearAll.enabled&&!t.clearAllAdded&&(e("<a/>").text(r.clearAll.label).attr({href:"#"}).attr(r.extraAttributes).addClass("clear-all-facets").addClass(r.class).addClass(r.clearAll.className).on("click",function(e){e.preventDefault(),t.clearAllAdded=!1,l.empty().hide(),a.facetsSelected=[],a.searchParams.start=0,t.currentPage=1,a.facetsApplied.onChange.call(a.facetsSelected),n()}).prependTo(l),t.clearAllAdded=!0);l.show()},groupWrapper:"<div/>",groupWrapperClass:"group"},facetsApplied:{container:null,class:"selected-facet",extraAttributes:{},ignoreFacets:[],clearAll:{enabled:!0,label:"Clear all",className:""},onChange:function(){}},facetsDictionary:null,facetsSelected:[],results:{container:"#results",template:null,noResults:"Sorry there are no results for your query",noResultsClasses:"",onCreate:function(){},loaderContainer:null,pager:{container:null,loadMore:!0,appendPager:!1,pagerRangeIncrement:5,enders:!0,labels:{prev:"Previous",next:"Next",first:"First",last:"Last",results:"results for",load:"load more",ada:{current:"You are on page",item:"Go to page",prev:"Go to the previous page of results",next:"Go to the next page of results",first:"Go to the first page of results",last:"Go to the last page of results",load:"Load more results"}},onRender:function(){},onPageChange:function(){}}},urlParameters:{address:"a",latitude:"l",longitude:"ln",latlong:null,search:"q",page:"p"},onResults:function(){(function(t){var r=a.facets,s=e(r.container);if(!s||!t.facets)return;s.html(""),e(Object.keys(a.facetsDictionary)).each(function(l,n){if(t.facets[n]){var c=n;"object"==typeof a.facetsDictionary[n]&&a.facetsDictionary[n].label?c=a.facetsDictionary[n].label:a.facetsDictionary&&a.facetsDictionary[n]&&(c=a.facetsDictionary[n]);var o=e(r.title).addClass(r.titleClass).text(c);r.titleWrapper&&(o=e(r.titleWrapper).addClass(r.titleWrapperClass).append(o)),s.append(o),o.on("click",r.titleOnClick);var d=e(r.wrapperContainer).addClass(r.wrapperContainerClass);s.append(d),"object"==typeof a.facetsDictionary[n]&&a.facetsDictionary[n].dropdown?function(t,r,s,l){var n=a.facets,c=e(n.container),o=e("<select />").data("cloudsearchFacetName",l).on("change",n.facetOnClick).append(e("<option />").text("Select"));t.append(o);var d=0;if(e(s.facets[l].buckets).each(function(t,r){var s=e("<option />").text(r.value).attr("value",r.value);n.showCount&&s.text(s.text()+" ("+r.count+")"),-1!=a.facetsSelected.indexOf(l+"||"+r.value)&&s.attr("selected","selected"),o.append(s),d++}),n.groupWrapper&&d>0){var i=e(n.groupWrapper).addClass(n.groupWrapperClass);c.append(i),r.appendTo(i),t.appendTo(i)}0==d&&(r.remove(),t.remove())}(d,o,t,n):function(t,r,s,l){var n=a.facets,c=e(n.container),o=0;if(e(s.facets[l].buckets).each(function(r,s){var c=e(n.facet).addClass(n.facetClass).html(s.value).on("click",n.facetOnClick).data("cloudsearchFacetName",l).data("cloudsearchFacetValue",s.value);n.showCount&&a.facets.countWrapper?e(a.facets.countWrapper).text("("+s.count+")").addClass(a.facets.countWrapperClass).appendTo(c):n.showCount&&c.append(" ("+s.count+")"),-1!=a.facetsSelected.indexOf(l+"||"+s.value)&&c.addClass("active-facet"),n.wrapper?e(n.wrapper).addClass(n.wrapperClass).append(c).appendTo(t):t.append(c),o++}),n.groupWrapper&&o>0){var d=e(n.groupWrapper).addClass(n.groupWrapperClass);c.append(d),r.appendTo(d),t.appendTo(d)}0==o&&(r.remove(),t.remove())}(d,o,t,n)}})})(this),function(r){var s=a.results,l=e(s.loaderContainer),n=e(s.container)?e(s.container):e(t.container);if(!n||!r.hits.hit)return;s.pager.loadMore&&0!=a.searchParams.skip||n.html("");0==r.hits.found&&(l&&l.fadeOut(),e("<div/>").addClass("cloudsearch-no-results "+s.noResultsClasses).text(s.noResults).appendTo(n));e(r.hits.hit).each(function(r,c){var o=c.fields;if(s.template){var d=e(s.template);e(':not([data-cloudsearch-field=""])',d).not().each(function(r,s){var l=e(s).data("cloudsearchField"),n="";if(l&&c.fields[l])n=c.fields[l];else if(l==a.geoSearch.fieldName&&t.isGeoSearch&&c[a.geoSearch.cloudFieldName]){var o=c[a.geoSearch.cloudFieldName];n=function(e,a,t,r,s){var l=Math.PI*e/180,n=Math.PI*t/180,c=a-r,o=Math.PI*c/180,d=Math.sin(l)*Math.sin(n)+Math.cos(l)*Math.cos(n)*Math.cos(o);d>1&&(d=1);d=60*(d=180*(d=Math.acos(d))/Math.PI)*1.1515,"K"==s&&(d*=1.609344);"N"==s&&(d*=.8684);return d}(a.geoSearch.lat,a.geoSearch.lng,o.coordinates[1],o.coordinates[0],a.geoSearch.unit)}var d=e(s).data("cloudsearchValueFormat");d&&window[d]&&(n=window[d](n,c)),l&&(void 0!==e(s).data("cloudsearchValueFormatReplace")?e(s).replaceWith(n):e(s).html(n))}),n.append(d),l&&l.fadeOut(),s.onCreate.call(d)}else{var i=e("<ul/>"),p=e("<hr/>");e(Object.keys(o)).each(function(a,t){if(!o[t]||""==o[t])return!0;var r=e("<li/>").text(t+" : ").appendTo(i);e("<strong/>").text(o[t]).appendTo(r)}),i.appendTo(n),p.appendTo(n),s.onCreate.call(i)}}),t.rendered=!0}(this),this.hits.found>a.searchParams.size&&(r=a.results.pager).appendPager&&(e(r.container).empty(),t.pagerRendered||(t.pagerRange[0]=1,t.pagerRange[1]=r.pagerRangeIncrement,t.currentPage>=r.pagerRangeIncrement&&(t.pagerRange[0]=Math.floor(t.currentPage/r.pagerRangeIncrement)*r.pagerRangeIncrement,t.pagerRange[1]=(Math.floor(t.currentPage/r.pagerRangeIncrement)+1)*r.pagerRangeIncrement)),function(){var r=a.results.pager,c=e(r.container);if(c){if(r.loadMore)c.append(s("load"));else{var o;r.enders&&c.append(s("first")),c.append(s("prev")),o=t.pagerRendered?e(".pager-nav-items").empty():e("<div/>").addClass("pager-nav-items");for(var d=t.pagerRange[0];d<=t.pagerRange[1]&&d<=t.totalPages;){var i=e('<a href="#">').data("targetPage",d);d===t.currentPage?(i=e("<span></span>")).attr("title",r.labels.ada.current+" "+d):i.attr("title",r.labels.ada.item+" "+d),i.text(d),o.append(i),d++}c?(c.append(o),c.append(s("next")),r.enders&&c.append(s("last"))):(c.append(s("next")),r.enders&&c.append(s("last")),e(t.container).after(c))}t.pagerRendered||(e(".pager-prev, .pager-next, .pager-load").on("click",function(r){var s;r.preventDefault(),e(this).data("disabled")||(s=e(this).hasClass("pager-prev"),a.results.pager,a.searchParams.size&&t.currentPage&&t.rendered&&(t.rendered=!1,t.currentPage=s?t.currentPage-1:t.currentPage+1,a.searchParams.start=(t.currentPage-1)*a.searchParams.size,n()))}),e(".pager-last, .pager-first").on("click",function(a){a.preventDefault(),e(this).data("disabled")||l(e(this).data("targetPage"))}),e(".pager-nav-items a").on("click",function(a){a.preventDefault(),l(e(this).data("targetPage"))}))}}(),t.pagerRendered=!0);var r;a.onLoad.call(this,t)},onLoad:function(){},debug:!1},t={container:null,totalPages:0,currentPage:1,pagerRange:[],pagerRendered:!1,waitingLatLong:!1,isGeoSearch:!1,totalResults:0,initialized:!1,rendered:!1,fromDate:null,toDate:null,clearAllAdded:!1};function r(e){c("Google Geocode return:"),c(e);"OK"==e.status&&e.results.length>0&&(a.geoSearch.lat=e.results[0].geometry.location.lat,a.geoSearch.lng=e.results[0].geometry.location.lng),t.waitingLatLong=!1,n()}function s(r){var s=a.results.pager,l=e("<a/>").text(s.labels[r]).addClass("pager-navs").addClass("pager-"+r).attr("href","#").attr("title",s.labels.ada[r]);return"first"==r?l.data("targetPage",1):"last"==r&&l.data("targetPage",t.totalPages),t.pagerRendered&&(l=e(".pager-navs.pager-"+r)),"prev"==r||"first"==r?t.currentPage>1?l.data("disabled",!1).removeClass("disabled"):l.data("disabled",!0).addClass("disabled"):t.totalPages>t.currentPage?l.data("disabled",!1).removeClass("disabled"):l.data("disabled",!0).addClass("disabled"),l}function l(e){t.currentPage=e,a.searchParams.start=(t.currentPage-1)*a.searchParams.size,n()}function n(){if(t.isGeoSearch=!1,a.results.loaderContainer&&e(a.results.loaderContainer).fadeIn(),e(a.results.pager.container).empty(),t.pagerRendered=!1,!t.waitingLatLong){if(a.geoSearch.lat&&a.geoSearch.lng&&(c("Geo searching..."),c(a.geoSearch.lat),c(a.geoSearch.lng),t.isGeoSearch=!0,!a.searchParams.orderby||0==a.searchParams.orderby.indexOf(a.geoSearch.fieldName))){var r="geo.distance("+a.geoSearch.cloudFieldName;r+=", geography'POINT("+a.geoSearch.lng+" "+a.geoSearch.lat+")')",a.searchParams.orderby&&-1!=a.searchParams.orderby.indexOf(" desc")&&(r+=" desc"),a.searchParams.orderby=r}var s=null,l=a.searchParams.fq;if(a.facetsDictionary&&e(Object.keys(a.facetsDictionary)).each(function(e,t){var r="{}";"object"==typeof a.facetsDictionary[t]&&a.facetsDictionary[t].params&&(r=a.facetsDictionary[t].params),a.searchParams["facet."+t]=r}),a.facetsSelected.length>0){var n=[];a.facetsSelected.forEach(function(e,a){var t=e.split("||");n.push(t[0]+": '"+t[1].replace(/[']/gi,"\\'")+"'")}),s=n.join(" ")}var o="";t.dateSearch&&(t.fromDate&&(o=a.dates.fields.from.cloudSearchField+": ['"+t.fromDate.toISOString()+"'"),t.toDate&&a.dates.fields.from.cloudSearchField==a.dates.fields.to.cloudSearchField?(t.fromDate||(o+=a.dates.fields.to.cloudSearchField+":{"),o+=",'"+t.toDate.toISOString()+"']"):t.toDate?(t.fromDate&&(o+=",} "),o+=a.dates.fields.to.cloudSearchField+":{",o+=",'"+t.toDate.toISOString()+"']"):t.fromDate&&(o+=",}"),s?s+=" "+o:s=o),s&&(s=l?"("+a.facets.searchMode+" "+l+" "+s+")":"("+a.facets.searchMode+" "+s+")",a.searchParams.fq=s);var d={crossDomain:!0,url:a.cloudSearch.url,method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","X-Api-Key":a.cloudSearch.key,"Cache-Control":"no-cache"},data:a.searchParams};e.ajax(d).done(function(e){e.hits?(t.totalResults=e.hits.found>0?e.hits.found:-1,t.totalPages=Math.ceil(t.totalResults/a.searchParams.size),a.onResults.call(e,t)):e.error&&c(e.error)}),a.searchParams.fq=l}}function c(e){a.debug&&window.console&&window.console.log&&window.console.log(e)}function o(e){if(!e)return null;var a,t,r=decodeURIComponent(window.location.search.substring(1)).split("&");for(t=0;t<r.length;t++)if((a=r[t].split("="))[0]===e)return void 0===a[1]||a[1];return null}e.fn.cloudsearch=function(s,l){switch(t.container=this,l||(l="search"),s&&(s.cloudSearch&&(s.cloudSearch=e.extend(a.cloudSearch,s.cloudSearch)),s.googleGeocodeApi&&(s.googleGeocodeApi=e.extend(a.googleGeocodeApi,s.googleGeocodeApi)),s.geoSearch&&(s.geoSearch=e.extend(a.geoSearch,s.geoSearch)),s.searchParms&&(s.searchParms=e.extend(a.searchParms,s.searchParms)),s.dates&&(s.dates=e.extend(!0,a.dates,s.dates)),s.facets&&(s.facets=e.extend(a.facets,s.facets)),s.facetsApplied&&(s.facetsApplied=e.extend(!0,a.facetsApplied,s.facetsApplied)),s.results&&(s.results=e.extend(!0,a.results,s.results)),s.urlParameters&&(s.urlParameters=e.extend(a.urlParameters,s.urlParameters)),a=e.extend(a,s),function(){var s=a.urlParameters,l=o(s.address),n=o(s.latitude),c=o(s.longitude),d=o(s.latlong),i=o(s.search);d&&-1!=d.indexOf(",")&&(n=d.split(",")[0],c=d.split(",")[1]);if(i){var p=i.replace(/[']/gi,"\\'");"structured"==a.searchParams["q.parser"]?0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1?a.searchParams.q="(phrase '"+p+"')":0===i.indexOf("'")&&i.lastIndexOf("'")===i.length-1?a.searchParams.q="(phrase "+i.replace("'","\\'")+")":(a.searchParams.q="(or ",a.searchParams.q+="(term '"+p+"')",a.searchParams.q+="(prefix '"+p+"')",a.searchParams.q+=")"):a.searchParams.q="'"+p+"'"}n&&c&&(a.geoSearch.lat=n,a.geoSearch.lng=c);if(l&&!n&&!c&&!d){var u=function(s){var l=a.googleGeocodeApi;if(!l.key)return;t.waitingLatLong=!0;var n=l.url;n+=-1!=n.indexOf("?")?"&":"?",n+="key="+l.key,n+="&address="+s,n+="&language="+l.language,e.getJSON(n,r)}(l);u&&(n=u[0],c=u[1])}}()),t.initialized||e(a.facetsSelected).each(function(e,t){a.facets.onFacetSelect.call([t])}),a.dates.hasDates&&function(){var r=a.dates.fields;if(!r.from.selector||!r.from.cloudSearchField)return;var s=r.from.selector;r.to.selector&&r.to.cloudSearchField&&r.from.selector?s+=", "+r.to.selector:r.to.selector&&r.to.cloudSearchField&&(s=r.to.selector);function l(e,s){if(t[s]=null,e&&s){e=r.zone?e+" "+r.zone:e;var l=new Date(e);t[s]=l}t.fromDate||t.toDate?t.dateSearch=!0:t.dateSearch=!1,a.searchParams.start=0,t.currentPage=1,n()}e(s).on("change",function(a){l(e(this).val(),e(this).data("dateDir"))}),e(s).on("keydown",function(a){13===a.which?(a.preventDefault(),l(e(this).val(),e(this).data("dateDir"))):8!=a.which&&46!=a.which||(a.preventDefault(),e(this).val(""),l(e(this).val(),e(this).data("dateDir")))})}(),l){case"search":n();break;case"resetFacets":a.facetsSelected=[],a.facets.onFacetSelect.call(a.facetsSelected),n()}return t.initialized=!0,this}}(jQuery);