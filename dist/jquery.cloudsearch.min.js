!function(e){var a={cloudSearch:{url:"",key:""},googleGeocodeApi:{key:null,url:"https://maps.googleapis.com/maps/api/geocode/json",language:"en"},geoSearch:{lat:null,lng:null,fieldName:"_distance",cloudFieldName:null,unit:"K",maxDistance:null},searchParams:{q:"matchall",return:"_all_fields",size:10,sort:"_score desc",start:0,"q.parser":"structured"},facets:{displayFacets:[],facet:'<a href="#"/>',facetClass:"facet",titleWrapper:"<h2/>",title:'<a href="#"/>',titleClass:"",titleOnClick:function(){},titleWrapperClass:"facet-title",container:"#facets",wrapperContainer:"<ul/>",wrapperContainerClass:"facet-list",wrapper:"<li/>",wrapperClass:"facet-item",showCount:!0,countWrapper:null,countWrapperClass:null,facetOnClick:function(t){t.preventDefault();var r=e(this).data("cloudsearchFacetName")+"|"+e(this).data("cloudsearchFacetValue");if(-1!=a.facetsSelected.indexOf(r))return;console.log(r),a.facetsSelected.push(r),console.log(a.facetsSelected),a.facetsApplied.onChange.call(a.facetsSelected.slice(0)),a.facets.onFacetSelect.call(a.facetsSelected.slice(0))},searchMode:"and",onFacetSelect:function(){var t=a.facetsApplied;if(!t.container)return;var r=this.pop(),n=e(t.container),c=r.split("|");if(-1!=t.ignoreFacets.indexOf(c[0]))return;e("<a/>").text(c[1]).attr({href:"#"}).attr(t.extraAttributes).data("value",r).addClass(t.class).on("click",function(){a.facetsSelected.splice(a.facetsSelected.indexOf(e(this).data("value")),1),a.facetsApplied.onChange.call(a.facetsSelected.slice(0)),e(this).remove(),s()}).appendTo(n)},groupWrapper:"<div/>",groupWrapperClass:"group"},facetsApplied:{container:null,class:"selected-facet",extraAttributes:{},ignoreFacets:[],onChange:function(){}},facetsDictionary:null,facetsSelected:[],results:{container:"#results",template:null,onCreate:function(){},pager:{container:null,renderPager:!1,loadMore:!0,appendPager:!0,pagerRangeIncrement:5,labels:{prev:"previous",next:"next",first:"first",last:"last",results:"results for",load:"load more",ada:{prev:"previous page of results",next:"next page of results",first:"first page of results",last:"last page of results",load:"load more results"}},onRender:function(){},onPageChange:function(){}}},urlParameters:{address:"a",latitude:"l",longitude:"ln",latlong:null,search:"q",page:"p"},onResults:function(){(function(t){var r=a.facets,n=e(r.container);if(!n||!t.facets)return;n.html(""),console.log(a.facets.displayFacets),e(Object.keys(a.facetsDictionary)).each(function(s,c){if(t.facets[c]){console.log("facets exists for : "+c);var l=a.facetsDictionary&&a.facetsDictionary[c]?a.facetsDictionary[c]:c,o=e(r.title).addClass(r.titleClass).text(l);r.titleWrapper&&(o=e(r.titleWrapper).addClass(r.titleWrapperClass).append(o)),n.append(o),o.on("click",r.titleOnClick);var i=e(r.wrapperContainer).addClass(r.wrapperContainerClass);n.append(i);var d=0;if(e(t.facets[c].buckets).each(function(t,n){var s=e(r.facet).addClass(r.facetClass).html(n.value).on("click",r.facetOnClick).data("cloudsearchFacetName",c).data("cloudsearchFacetValue",n.value);if(r.showCount&&a.facets.countWrapper?e(a.facets.countWrapper).text("("+n.count+")").addClass(a.facets.countWrapperClass).appendTo(s):r.showCount&&s.append(" ("+n.count+")"),-1!=a.facetsSelected.indexOf(c+"|"+n.value))return!0;r.wrapper?e(r.wrapper).addClass(r.wrapperClass).append(s).appendTo(i):i.append(s),d++}),r.groupWrapper){var p=e(r.groupWrapper).addClass(r.groupWrapperClass);n.append(p),o.appendTo(p),i.appendTo(p)}0==d&&o.remove()}})})(this),function(r){var n=a.results,s=e(n.container)?e(n.container):e(t.container);if(!s||!r.hits.hit)return;n.pager.loadMore&&0!=a.searchParams.skip||s.html("");e(r.hits.hit).each(function(r,c){var l=c.fields;if(n.template){var o=e(n.template);e(':not([data-cloudsearch-field=""])',o).not().each(function(r,n){var s=e(n).data("cloudsearchField"),l="";if(s&&c.fields[s])l=c.fields[s];else if(s==a.geoSearch.fieldName&&t.isGeoSearch&&c[a.geoSearch.cloudFieldName]){var o=c[a.geoSearch.cloudFieldName];l=function(e,a,t,r,n){var s=Math.PI*e/180,c=Math.PI*t/180,l=a-r,o=Math.PI*l/180,i=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos(o);i>1&&(i=1);i=60*(i=180*(i=Math.acos(i))/Math.PI)*1.1515,"K"==n&&(i*=1.609344);"N"==n&&(i*=.8684);return i}(a.geoSearch.lat,a.geoSearch.lng,o.coordinates[1],o.coordinates[0],a.geoSearch.unit)}var i=e(n).data("cloudsearchValueFormat");i&&window[i]&&(l=window[i](l,c)),s&&e(n).html(l)}),s.append(o),n.onCreate.call(o)}else{var i=e("<ul/>"),d=e("<hr/>");e(Object.keys(l)).each(function(a,t){if(!l[t]||""==l[t])return!0;var r=e("<li/>").text(t+" : ").appendTo(i);e("<strong/>").text(l[t]).appendTo(r)}),i.appendTo(s),d.appendTo(s),n.onCreate.call(i)}}),t.rendered=!0}(this),r=a.results.pager,r.renderPager&&(t.totalPages=Math.ceil(t.totalResults/a.searchParams.size),t.pagerRendered||(t.pagerRange=[1,r.pagerRangeIncrement]),function(){var r=a.results.pager,c=e(r.container);if(c){if(r.loadMore)c.append(n("load"));else{var l;t.currentPage<t.pagerRange[0]?(t.pagerRange[0]=t.pagerRange[0]-r.pagerRangeIncrement,t.pagerRange[1]=t.pagerRange[1]-r.pagerRangeIncrement):t.currentPage>t.pagerRange[1]&&(t.pagerRange[0]=t.pagerRange[0]+r.pagerRangeIncrement,t.pagerRange[1]=t.pagerRange[1]+r.pagerRangeIncrement),c.append(n("prev")),l=t.pagerRendered?e(".pager-nav-items").empty():e("<div/>").addClass("pager-nav-items");for(var o=t.pagerRange[0];o<=t.pagerRange[1]&&o<=t.totalPages;){var i=e('<a href="#">').data("targetPage",o);o===t.currentPage&&(i=e("<span></span>")),i.text(o),l.append(i),o++}c?(c.append(l),c.append(n("next"))):(c.append(n("next")),e(t.container).after(c))}t.pagerRendered||(e(document).on("click",".pager-prev, .pager-next, .pager-load",function(r){var n;r.preventDefault(),e(this).data("disabled")||(n=e(this).hasClass("pager-prev"),a.results.pager,a.searchParams.size&&t.currentPage&&t.rendered&&(t.rendered=!1,t.currentPage=n?t.currentPage-1:t.currentPage+1,a.searchParams.start=(t.currentPage-1)*a.searchParams.size,s()))}),e(document).on("click",".pager-nav-items a",function(r){var n;r.preventDefault(),n=e(this).data("targetPage"),t.currentPage=n,a.searchParams.skip=(t.currentPage-1)*a.searchParams.size,s()}))}}(),t.pagerRendered=!0),a.onLoad.call(this,t);var r},onLoad:function(){},debug:!1},t={container:null,totalPages:0,currentPage:1,pagerRange:[],pagerRendered:!1,waitingLatLong:!1,isGeoSearch:!1,totalResults:0,initialized:!1,rendered:!1};function r(e){c("Google Geocode return:"),c(e);"OK"==e.status&&e.results.length>0&&(a.geoSearch.lat=e.results[0].geometry.location.lat,a.geoSearch.lng=e.results[0].geometry.location.lng),t.waitingLatLong=!1,s()}function n(r){var n=a.results.pager,s=e("<a/>").text(n.labels[r]).addClass("pager-navs").addClass("pager-"+r).attr("href","#");return t.pagerRendered&&(s=e(".pager-navs.pager-"+r)),"prev"==r?t.currentPage>1?s.data("disabled",!1).removeClass("disabled"):s.data("disabled",!0).addClass("disabled"):t.totalPages>t.currentPage?s.data("disabled",!1).removeClass("disabled"):s.data("disabled",!0).addClass("disabled"),s}function s(){if(t.isGeoSearch=!1,!t.waitingLatLong){if(a.geoSearch.lat&&a.geoSearch.lng&&(c("Geo searching..."),c(a.geoSearch.lat),c(a.geoSearch.lng),t.isGeoSearch=!0,!a.searchParams.orderby||0==a.searchParams.orderby.indexOf(a.geoSearch.fieldName))){var r="geo.distance("+a.geoSearch.cloudFieldName;r+=", geography'POINT("+a.geoSearch.lng+" "+a.geoSearch.lat+")')",a.searchParams.orderby&&-1!=a.searchParams.orderby.indexOf(" desc")&&(r+=" desc"),a.searchParams.orderby=r}var n=null,s=a.searchParams.filter;if(console.log(Object.keys(a.facetsDictionary)),a.facetsDictionary&&e(Object.keys(a.facetsDictionary)).each(function(e,t){a.searchParams["facet."+t]="{}"}),a.facetsSelected.length>0){var l=[];a.facetsSelected.forEach(function(e,a){var t=e.split("|");l.push(t[0]+"/any(m: m eq '"+t[1].replace(/[']/gi,"''")+"')")}),n=l.join(" "+a.facets.searchMode+" "),s&&(n=a.searchParams.filter+" "+a.facets.searchMode+" "+n)}if(t.isGeoSearch&&a.geoSearch.maxDistance){c("Filter Geo searching by distance : "+a.geoSearch.maxDistance);var o="geo.distance("+a.geoSearch.cloudFieldName+", geography'POINT("+a.geoSearch.lng+" "+a.geoSearch.lat+")') le "+a.geoSearch.maxDistance;n?n+=" and "+o:n=o}n&&(a.searchParams.filter=n);var i={crossDomain:!0,url:a.cloudSearch.url,method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","X-Api-Key":a.cloudSearch.key,"Cache-Control":"no-cache"},data:a.searchParams};e.ajax(i).done(function(e){e.hits?(t.totalResults=e.hits.found>0?e.hits.found:-1,a.onResults.call(e,t)):e.error&&c(e.error)})}}function c(e){a.debug&&window.console&&window.console.log&&window.console.log(e)}function l(e){if(!e)return null;var a,t,r=decodeURIComponent(window.location.search.substring(1)).split("&");for(t=0;t<r.length;t++)if((a=r[t].split("="))[0]===e)return void 0===a[1]||a[1];return null}e.fn.cloudsearch=function(n,c){switch(t.container=this,c||(c="search"),n&&(a=e.extend(!0,a,n),function(){var n=a.urlParameters,s=l(n.address),c=l(n.latitude),o=l(n.longitude),i=l(n.latlong),d=l(n.search);i&&-1!=i.indexOf(",")&&(c=i.split(",")[0],o=i.split(",")[1]);d&&(a.searchParams.q=d);c&&o&&(a.geoSearch.lat=c,a.geoSearch.lng=o);if(s&&!c&&!o&&!i){var p=function(n){var s=a.googleGeocodeApi;if(!s.key)return;t.waitingLatLong=!0;var c=s.url;c+=-1!=c.indexOf("?")?"&":"?",c+="key="+s.key,c+="&address="+n,c+="&language="+s.language,e.getJSON(c,r)}(s);p&&(c=p[0],o=p[1])}}()),t.initialized||e(a.facetsSelected).each(function(e,t){a.facets.onFacetSelect.call([t])}),c){case"search":s();break;case"resetFacets":a.facetsSelected=[],a.facets.onFacetSelect.call(a.facetsSelected),s()}return t.initialized=!0,this}}(jQuery);