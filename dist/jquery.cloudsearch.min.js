!function(e){var a={cloudSearch:{url:"",key:""},googleGeocodeApi:{key:null,url:"https://maps.googleapis.com/maps/api/geocode/json",language:"en"},geoSearch:{lat:null,lng:null,fieldName:"_distance",cloudFieldName:null,unit:"K",maxDistance:null},searchParms:{search:"*",facets:[],count:!0,top:50,skip:0,filter:null,orderby:null},facets:{facet:'<a href="#"/>',facetClass:"facet",titleWrapper:"<h2/>",title:'<a href="#"/>',titleClass:"",titleOnClick:function(){},titleWrapperClass:"facet-title",container:"#facets",wrapperContainer:"<ul/>",wrapperContainerClass:"facet-list",wrapper:"<li/>",wrapperClass:"facet-item",showCount:!0,countWrapper:null,countWrapperClass:null,facetOnClick:function(t){t.preventDefault();var c=e(this).data("cloudsearchFacetName")+"|"+e(this).data("cloudsearchFacetValue");if(-1!=a.facetsSelected.indexOf(c))return;a.facetsSelected.push(c),a.facetsApplied.onChange.call(a.facetsSelected.slice(0)),a.facets.onFacetSelect.call(a.facetsSelected.slice(0)),r()},searchMode:"and",onFacetSelect:function(){var t=a.facetsApplied;if(!t.container)return;var c=this.pop(),l=e(t.container),n=c.split("|");if(-1!=t.ignoreFacets.indexOf(n[0]))return;e("<a/>").text(n[1]).attr({href:"#"}).attr(t.extraAttributes).data("value",c).addClass(t.class).on("click",function(){a.facetsSelected.splice(a.facetsSelected.indexOf(e(this).data("value")),1),a.facetsApplied.onChange.call(a.facetsSelected.slice(0)),e(this).remove(),r()}).appendTo(l)},groupWrapper:"<div/>",groupWrapperClass:"group"},facetsApplied:{container:null,class:"selected-facet",extraAttributes:{},ignoreFacets:[],onChange:function(){}},facetsDictionary:null,facetsSelected:[],results:{container:"#results",template:null,onCreate:function(){},alwaysClearContainer:!1},urlParameters:{address:"a",latitude:"l",longitude:"ln",latlong:null,search:"q"},onResults:function(){(function(t){var c=a.facets,r=e(c.container);if(!r||!t["@search.facets"])return;r.html(""),e(a.searchParms.facets).each(function(l,n){if(-1!=n.indexOf(",")&&(n=n.split(",")[0]),t["@search.facets"][n]){var s=a.facetsDictionary&&a.facetsDictionary[n]?a.facetsDictionary[n]:n,o=e(c.title).addClass(c.titleClass).text(s);c.titleWrapper&&(o=e(c.titleWrapper).addClass(c.titleWrapperClass).append(o)),r.append(o),o.on("click",c.titleOnClick);var i=e(c.wrapperContainer).addClass(c.wrapperContainerClass);r.append(i);var d=0;if(e(t["@search.facets"][n]).each(function(t,r){var l=e(c.facet).addClass(c.facetClass).html(r.value).on("click",c.facetOnClick).data("cloudsearchFacetName",n).data("cloudsearchFacetValue",r.value);if(c.showCount&&a.facets.countWrapper?e(a.facets.countWrapper).text("("+r.count+")").addClass(a.facets.countWrapperClass).appendTo(l):c.showCount&&l.append(" ("+r.count+")"),-1!=a.facetsSelected.indexOf(n+"|"+r.value))return!0;c.wrapper?e(c.wrapper).addClass(c.wrapperClass).append(l).appendTo(i):i.append(l),d++}),c.groupWrapper){var u=e(c.groupWrapper).addClass(c.groupWrapperClass);r.append(u),o.appendTo(u),i.appendTo(u)}0==d&&o.remove()}})})(this),function(c){var r=a.results,l=e(r.container);if(!l||!c.value)return;(r.alwaysClearContainer||0==a.searchParms.skip)&&l.html("");e(c.value).each(function(c,n){if(r.template){var s=e(r.template);e(':not([data-cloudsearch-field=""])',s).each(function(c,r){var l=e(r).data("cloudsearchField"),s="";if(l&&n[l])s=n[l];else if(l==a.geoSearch.fieldName&&t.isGeoSearch&&n[a.geoSearch.cloudFieldName]){var o=n[a.geoSearch.cloudFieldName];s=function(e,a,t,c,r){var l=Math.PI*e/180,n=Math.PI*t/180,s=a-c,o=Math.PI*s/180,i=Math.sin(l)*Math.sin(n)+Math.cos(l)*Math.cos(n)*Math.cos(o);i>1&&(i=1);i=60*(i=180*(i=Math.acos(i))/Math.PI)*1.1515,"K"==r&&(i*=1.609344);"N"==r&&(i*=.8684);return i}(a.geoSearch.lat,a.geoSearch.lng,o.coordinates[1],o.coordinates[0],a.geoSearch.unit)}var i=e(r).data("cloudsearchValueFormat");i&&window[i]&&(s=window[i](s,n)),l&&e(r).html(s)}),l.append(s),r.onCreate.call(s)}else{var o=e("<dl/>");e(Object.keys(n)).each(function(a,t){if(!n[t]||""==n[t])return!0;e("<dt/>").text(t).appendTo(o),e("<dd/>").text(n[t]).appendTo(o)}),o.appendTo(l),r.onCreate.call(o)}})}(this),a.onLoad.call(this,t)},onLoad:function(){},debug:!1},t={waitingLatLong:!1,isGeoSearch:!1,totalResults:0,initialized:!1};function c(e){l("Google Geocode return:"),l(e);"OK"==e.status&&e.results.length>0&&(a.geoSearch.lat=e.results[0].geometry.location.lat,a.geoSearch.lng=e.results[0].geometry.location.lng),t.waitingLatLong=!1,r()}function r(){console.log(a.cloudSearch.url);var t={crossDomain:!0,url:a.cloudSearch.url,method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","api-key":a.cloudSearch.key,"Cache-Control":"no-cache"}};e.ajax(t).done(function(e){})}function l(e){a.debug&&window.console&&window.console.log&&window.console.log(e)}function n(e){if(!e)return null;var a,t,c=decodeURIComponent(window.location.search.substring(1)).split("&");for(t=0;t<c.length;t++)if((a=c[t].split("="))[0]===e)return void 0===a[1]||a[1];return null}e.fn.cloudsearch=function(l,s){switch(s||(s="search"),l&&(l.googleGeocodeApi&&(l.googleGeocodeApi=e.extend(a.googleGeocodeApi,l.googleGeocodeApi)),l.searchParms&&(l.searchParms=e.extend(a.searchParms,l.searchParms)),l.facets&&(l.facets=e.extend(a.facets,l.facets)),l.facetsApplied&&(l.facetsApplied=e.extend(a.facetsApplied,l.facetsApplied)),l.results&&(l.results=e.extend(a.results,l.results)),l.geoSearch&&(l.geoSearch=e.extend(a.geoSearch,l.geoSearch)),l.urlParameters&&(l.urlParameters=e.extend(a.urlParameters,l.urlParameters)),a=e.extend(a,l),function(){var r=a.urlParameters,l=n(r.address),s=n(r.latitude),o=n(r.longitude),i=n(r.latlong),d=n(r.search);i&&-1!=i.indexOf(",")&&(s=i.split(",")[0],o=i.split(",")[1]);d&&(a.searchParms.search=d);s&&o&&(a.geoSearch.lat=s,a.geoSearch.lng=o);if(l&&!s&&!o&&!i){var u=function(r){var l=a.googleGeocodeApi;if(!l.key)return;t.waitingLatLong=!0;var n=l.url;n+=-1!=n.indexOf("?")?"&":"?",n+="key="+l.key,n+="&address="+r,n+="&language="+l.language,e.getJSON(n,c)}(l);u&&(s=u[0],o=u[1])}}()),t.initialized||e(a.facetsSelected).each(function(e,t){a.facets.onFacetSelect.call([t])}),s){case"search":r();break;case"resetFacets":a.facetsSelected=[],a.facets.onFacetSelect.call(a.facetsSelected),r()}return t.initialized=!0,this}}(jQuery);